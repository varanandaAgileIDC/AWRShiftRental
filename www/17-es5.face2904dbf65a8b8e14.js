function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var o=0;o<n.length;o++){var e=n[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,n,o){return n&&_defineProperties(t.prototype,n),o&&_defineProperties(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{RhO1:function(t,n,o){"use strict";o.r(n),o.d(n,"TrackingPageModule",(function(){return w}));var e=o("ofXK"),i=o("3Pt+"),a=o("TEn/"),r=o("tyNb"),c=o("pLZG"),s=o("fXoL"),l=o("Bfh1"),u=o("92l+"),p=o("WOgW"),b=["map"];function g(t,n){if(1&t){var o=s.Nb();s.Mb(0,"ion-button",11),s.Ub("click",(function(){return s.fc(o),s.Wb().startTracking()})),s.Kb(1,"ion-icon",12),s.jc(2," Start Tracking "),s.Lb()}}function f(t,n){if(1&t){var o=s.Nb();s.Mb(0,"ion-button",13),s.Ub("click",(function(){return s.fc(o),s.Wb().stopTracking()})),s.Kb(1,"ion-icon",14),s.jc(2," Stop Tracking "),s.Lb()}}function h(t,n){if(1&t){var o=s.Nb();s.Mb(0,"ion-item"),s.Mb(1,"p",15),s.jc(2),s.Xb(3,"date"),s.Lb(),s.Mb(4,"ion-button",16),s.Ub("click",(function(){s.fc(o);var t=n.$implicit;return s.Wb().showHistoryRoute(t.path)})),s.jc(5,"View Route"),s.Lb(),s.Lb()}if(2&t){var e=n.$implicit;s.zb(2),s.mc("",s.Yb(3,2,e.finished),", ",e.path.length," Waypoints ")}}var d,k,m,M=[{path:"",component:(d=function(){function t(n,o,e,i,a){_classCallCheck(this,t),this.platform=n,this.router=o,this.geolocation=e,this.locationAccuracy=i,this.androidPerm=a,this.currentMapTrack=null,this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.platform.ready().then((function(){t.loadHistoricRoutes();var n={zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1};t.map=new google.maps.Map(t.mapElement.nativeElement,n),t.geolocation.getCurrentPosition().then((function(n){var o=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);t.map.setCenter(o),t.map.setZoom(16)})).catch((function(t){console.log("Error getting location",t)}))}))}},{key:"ionViewDidEnter",value:function(){var t=this;this.platform.backButton.subscribeWithPriority(10,(function(n){console.log("Back press handler!"),t.router.navigate(["/tabs"])}))}},{key:"loadHistoricRoutes",value:function(){var t=JSON.parse(localStorage.getItem("routes"));t&&(this.previousTracks=t)}},{key:"startTracking",value:function(){var t=this;this.isTracking=!0,this.trackedRoute=[],this.positionSubscription=this.geolocation.watchPosition().pipe(Object(c.a)((function(t){return void 0!==t.coords}))).subscribe((function(n){setTimeout((function(){t.trackedRoute.push({lat:n.coords.latitude,lng:n.coords.longitude}),t.redrawPath(t.trackedRoute)}),0)}))}},{key:"redrawPath",value:function(t){this.currentMapTrack&&this.currentMapTrack.setMap(null),t.length>1&&(console.log("origin",t[0].lat,t[0].lng),console.log("destination",t[t.length-1].lat,t[t.length-1].lng),this.distance=this.getDistanceFromLatLonInKm(t[0].lat,t[0].lng,t[t.length-1].lat,t[t.length-1].lng)+"km",this.currentMapTrack=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map))}},{key:"stopTracking",value:function(){var t={finished:(new Date).getTime(),path:this.trackedRoute};this.previousTracks.push(t),localStorage.setItem("routes",JSON.stringify(this.previousTracks)),this.isTracking=!1,this.positionSubscription.unsubscribe(),this.currentMapTrack.setMap(null)}},{key:"showHistoryRoute",value:function(t){this.redrawPath(t)}},{key:"getDistanceFromLatLonInKm",value:function(t,n,o,e){var i=this.deg2rad(o-t),a=this.deg2rad(e-n),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(o))*Math.sin(a/2)*Math.sin(a/2);return(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371).toFixed(0)}},{key:"deg2rad",value:function(t){return t*(Math.PI/180)}}]),t}(),d.\u0275fac=function(t){return new(t||d)(s.Jb(a.J),s.Jb(r.g),s.Jb(l.a),s.Jb(u.a),s.Jb(p.a))},d.\u0275cmp=s.Db({type:d,selectors:[["app-tracking"]],viewQuery:function(t,n){var o;1&t&&s.nc(b,!0),2&t&&s.ec(o=s.Vb())&&(n.mapElement=o.first)},decls:20,vars:3,consts:[["slot","start"],[1,"notifications-btn"],["name","notifications-outline"],[2,"text-align","center"],["full","","icon-left","","class","trackBtn",3,"click",4,"ngIf"],["full","","color","danger","icon-left","","class","trackBtn",3,"click",4,"ngIf"],[1,"map-wrapper"],["id","map"],["map",""],["slot","start",1,"viewRoute",2,"margin-left","20px"],[4,"ngFor","ngForOf"],["full","","icon-left","",1,"trackBtn",3,"click"],["name","locate"],["full","","color","danger","icon-left","",1,"trackBtn",3,"click"],["name","hand"],[2,"font-size","12px"],["slot","end",1,"viewRoute",3,"click"]],template:function(t,n){1&t&&(s.Mb(0,"ion-content"),s.Mb(1,"ion-header"),s.Mb(2,"ion-toolbar"),s.Mb(3,"ion-buttons",0),s.Kb(4,"ion-menu-button"),s.Lb(),s.Mb(5,"ion-title"),s.jc(6," Tracking "),s.Lb(),s.Mb(7,"ion-button",1),s.Kb(8,"ion-icon",2),s.Lb(),s.Lb(),s.Lb(),s.Mb(9,"ion-content"),s.Mb(10,"div",3),s.ic(11,g,3,0,"ion-button",4),s.ic(12,f,3,0,"ion-button",5),s.Lb(),s.Mb(13,"div",6),s.Kb(14,"div",7,8),s.Lb(),s.Mb(16,"ion-list"),s.Mb(17,"ion-button",9),s.jc(18,"Previous Tracks"),s.Lb(),s.ic(19,h,6,4,"ion-item",10),s.Lb(),s.Lb(),s.Lb()),2&t&&(s.zb(11),s.bc("ngIf",!n.isTracking),s.zb(1),s.bc("ngIf",n.isTracking),s.zb(7),s.bc("ngForOf",n.previousTracks))},directives:[a.j,a.l,a.F,a.g,a.s,a.E,a.f,a.m,e.j,a.q,e.i,a.o],pipes:[e.d],styles:["ion-title[_ngcontent-%COMP%]{float:left;top:11px;position:relative;font-weight:400;padding-left:0}.menu-btn[_ngcontent-%COMP%]{float:left}.menu-btn[_ngcontent-%COMP%], .notifications-btn[_ngcontent-%COMP%]{--background:transparent;--box-shadow:none;color:#fff}.notifications-btn[_ngcontent-%COMP%]{float:right}ion-content[_ngcontent-%COMP%]{--background:none;background-image:url(/assets/body-bg.png);background-position:top;background-repeat:no-repeat;background-size:cover}.header-md[_ngcontent-%COMP%]:after{display:none}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--ion-color-base:transparent!important;--box-shadow:none;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:50vh}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   #map_center[_ngcontent-%COMP%]{position:absolute;z-index:99;height:40px;width:40px;top:50%;left:50%;margin-left:-21px;margin-top:-41px}ion-item[_ngcontent-%COMP%]{--background:transparent;color:#fff;width:80%;height:44px;margin:20px auto 0;border-bottom:1px solid #fff}ion-list[_ngcontent-%COMP%]{background:transparent}.trackBtn[_ngcontent-%COMP%]{margin-top:20px;width:80%;height:55px}.trackBtn[_ngcontent-%COMP%], .viewRoute[_ngcontent-%COMP%]{--background:#1d97db;--box-shadow:none;--border-radius:14px;text-transform:none}"]}),d)}],v=((m=function t(){_classCallCheck(this,t)}).\u0275mod=s.Hb({type:m}),m.\u0275inj=s.Gb({factory:function(t){return new(t||m)},imports:[[r.i.forChild(M)],r.i]}),m),w=((k=function t(){_classCallCheck(this,t)}).\u0275mod=s.Hb({type:k}),k.\u0275inj=s.Gb({factory:function(t){return new(t||k)},imports:[[e.b,i.d,a.G,v]]}),k)}}]);