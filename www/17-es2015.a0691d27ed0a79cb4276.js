(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{RhO1:function(t,n,o){"use strict";o.r(n),o.d(n,"TrackingPageModule",(function(){return f}));var i=o("ofXK"),e=o("3Pt+"),r=o("TEn/"),a=o("tyNb"),c=o("pLZG"),s=o("fXoL"),l=o("Bfh1");const p=["map"];function g(t,n){if(1&t){const t=s.Nb();s.Mb(0,"ion-button",11),s.Ub("click",(function(){return s.fc(t),s.Wb().startTracking()})),s.Kb(1,"ion-icon",12),s.jc(2," Start Tracking "),s.Lb()}}function b(t,n){if(1&t){const t=s.Nb();s.Mb(0,"ion-button",13),s.Ub("click",(function(){return s.fc(t),s.Wb().stopTracking()})),s.Kb(1,"ion-icon",14),s.jc(2," Stop Tracking "),s.Lb()}}function u(t,n){if(1&t){const t=s.Nb();s.Mb(0,"ion-item"),s.Mb(1,"p",15),s.jc(2),s.Xb(3,"date"),s.Lb(),s.Mb(4,"ion-button",16),s.Ub("click",(function(){s.fc(t);const o=n.$implicit;return s.Wb().showHistoryRoute(o.path)})),s.jc(5,"View Route"),s.Lb(),s.Lb()}if(2&t){const t=n.$implicit;s.zb(2),s.lc("",s.Yb(3,2,t.finished),", ",t.path.length," Waypoints ")}}const h=[{path:"",component:(()=>{class t{constructor(t,n,o){this.platform=t,this.router=n,this.geolocation=o,this.currentMapTrack=null,this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[]}ngOnInit(){this.platform.ready().then(()=>{this.loadHistoricRoutes();let t={zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1};this.map=new google.maps.Map(this.mapElement.nativeElement,t),this.geolocation.getCurrentPosition().then(t=>{let n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);this.map.setCenter(n),this.map.setZoom(16)}).catch(t=>{console.log("Error getting location",t)})})}ionViewDidEnter(){this.platform.backButton.subscribeWithPriority(10,t=>{console.log("Back press handler!"),this.router.navigate(["/tabs"])})}loadHistoricRoutes(){let t=JSON.parse(localStorage.getItem("routes"));t&&(this.previousTracks=t)}startTracking(){this.isTracking=!0,this.trackedRoute=[],this.positionSubscription=this.geolocation.watchPosition().pipe(Object(c.a)(t=>void 0!==t.coords)).subscribe(t=>{setTimeout(()=>{this.trackedRoute.push({lat:t.coords.latitude,lng:t.coords.longitude}),this.redrawPath(this.trackedRoute)},0)})}redrawPath(t){this.currentMapTrack&&this.currentMapTrack.setMap(null),t.length>1&&(console.log("origin",t[0].lat,t[0].lng),console.log("destination",t[t.length-1].lat,t[t.length-1].lng),this.distance=this.getDistanceFromLatLonInKm(t[0].lat,t[0].lng,t[t.length-1].lat,t[t.length-1].lng)+"km",this.currentMapTrack=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map))}stopTracking(){let t={finished:(new Date).getTime(),path:this.trackedRoute};this.previousTracks.push(t),localStorage.setItem("routes",JSON.stringify(this.previousTracks)),this.isTracking=!1,this.positionSubscription.unsubscribe(),this.currentMapTrack.setMap(null)}showHistoryRoute(t){this.redrawPath(t)}getDistanceFromLatLonInKm(t,n,o,i){var e=this.deg2rad(o-t),r=this.deg2rad(i-n),a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(o))*Math.sin(r/2)*Math.sin(r/2);return(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371).toFixed(0)}deg2rad(t){return t*(Math.PI/180)}}return t.\u0275fac=function(n){return new(n||t)(s.Jb(r.J),s.Jb(a.g),s.Jb(l.a))},t.\u0275cmp=s.Db({type:t,selectors:[["app-tracking"]],viewQuery:function(t,n){var o;1&t&&s.mc(p,!0),2&t&&s.ec(o=s.Vb())&&(n.mapElement=o.first)},decls:20,vars:3,consts:[["slot","start"],[1,"notifications-btn"],["name","notifications-outline"],[2,"text-align","center"],["full","","icon-left","","class","trackBtn",3,"click",4,"ngIf"],["full","","color","danger","icon-left","","class","trackBtn",3,"click",4,"ngIf"],[1,"map-wrapper"],["id","map"],["map",""],["slot","start",1,"viewRoute",2,"margin-left","20px"],[4,"ngFor","ngForOf"],["full","","icon-left","",1,"trackBtn",3,"click"],["name","locate"],["full","","color","danger","icon-left","",1,"trackBtn",3,"click"],["name","hand"],[2,"font-size","12px"],["slot","end",1,"viewRoute",3,"click"]],template:function(t,n){1&t&&(s.Mb(0,"ion-content"),s.Mb(1,"ion-header"),s.Mb(2,"ion-toolbar"),s.Mb(3,"ion-buttons",0),s.Kb(4,"ion-menu-button"),s.Lb(),s.Mb(5,"ion-title"),s.jc(6," Tracking "),s.Lb(),s.Mb(7,"ion-button",1),s.Kb(8,"ion-icon",2),s.Lb(),s.Lb(),s.Lb(),s.Mb(9,"ion-content"),s.Mb(10,"div",3),s.ic(11,g,3,0,"ion-button",4),s.ic(12,b,3,0,"ion-button",5),s.Lb(),s.Mb(13,"div",6),s.Kb(14,"div",7,8),s.Lb(),s.Mb(16,"ion-list"),s.Mb(17,"ion-button",9),s.jc(18,"Previous Tracks"),s.Lb(),s.ic(19,u,6,4,"ion-item",10),s.Lb(),s.Lb(),s.Lb()),2&t&&(s.zb(11),s.bc("ngIf",!n.isTracking),s.zb(1),s.bc("ngIf",n.isTracking),s.zb(7),s.bc("ngForOf",n.previousTracks))},directives:[r.j,r.l,r.F,r.g,r.s,r.E,r.f,r.m,i.j,r.q,i.i,r.o],pipes:[i.d],styles:["ion-title[_ngcontent-%COMP%]{float:left;top:11px;position:relative;font-weight:400;padding-left:0}.menu-btn[_ngcontent-%COMP%]{float:left}.menu-btn[_ngcontent-%COMP%], .notifications-btn[_ngcontent-%COMP%]{--background:transparent;--box-shadow:none;color:#fff}.notifications-btn[_ngcontent-%COMP%]{float:right}ion-content[_ngcontent-%COMP%]{--background:none;background-image:url(/assets/body-bg.png);background-position:top;background-repeat:no-repeat;background-size:cover}.header-md[_ngcontent-%COMP%]:after{display:none}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--ion-color-base:transparent!important;--box-shadow:none;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:50vh}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   #map_center[_ngcontent-%COMP%]{position:absolute;z-index:99;height:40px;width:40px;top:50%;left:50%;margin-left:-21px;margin-top:-41px}ion-item[_ngcontent-%COMP%]{--background:transparent;color:#fff;width:80%;height:44px;margin:20px auto 0;border-bottom:1px solid #fff}ion-list[_ngcontent-%COMP%]{background:transparent}.trackBtn[_ngcontent-%COMP%]{margin-top:20px;width:80%;height:55px}.trackBtn[_ngcontent-%COMP%], .viewRoute[_ngcontent-%COMP%]{--background:#1d97db;--box-shadow:none;--border-radius:14px;text-transform:none}"]}),t})()}];let d=(()=>{class t{}return t.\u0275mod=s.Hb({type:t}),t.\u0275inj=s.Gb({factory:function(n){return new(n||t)},imports:[[a.i.forChild(h)],a.i]}),t})(),f=(()=>{class t{}return t.\u0275mod=s.Hb({type:t}),t.\u0275inj=s.Gb({factory:function(n){return new(n||t)},imports:[[i.b,e.d,r.G,d]]}),t})()}}]);