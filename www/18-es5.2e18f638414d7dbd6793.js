function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{RhO1:function(t,n,e){"use strict";e.r(n),e.d(n,"TrackingPageModule",(function(){return w}));var o=e("ofXK"),i=e("3Pt+"),a=e("TEn/"),r=e("tyNb"),c=e("pLZG"),s=e("fXoL"),l=e("Bfh1"),u=e("92l+"),p=e("WOgW"),g=["map"];function b(t,n){if(1&t){var e=s.Nb();s.Mb(0,"ion-button",11),s.Ub("click",(function(){return s.fc(e),s.Wb().startTracking()})),s.Kb(1,"ion-icon",12),s.jc(2," Start Tracking "),s.Lb()}}function f(t,n){if(1&t){var e=s.Nb();s.Mb(0,"ion-button",13),s.Ub("click",(function(){return s.fc(e),s.Wb().stopTracking()})),s.Kb(1,"ion-icon",14),s.jc(2," Stop Tracking "),s.Lb()}}function h(t,n){if(1&t){var e=s.Nb();s.Mb(0,"ion-item"),s.Mb(1,"p",15),s.jc(2),s.Xb(3,"date"),s.Lb(),s.Mb(4,"ion-button",16),s.Ub("click",(function(){s.fc(e);var t=n.$implicit;return s.Wb().showHistoryRoute(t.path)})),s.jc(5,"View Route"),s.Lb(),s.Lb()}if(2&t){var o=n.$implicit;s.zb(2),s.mc("",s.Yb(3,2,o.finished),", ",o.path.length," Waypoints ")}}var d,m,k,M=[{path:"",component:(d=function(){function t(n,e,o,i,a){_classCallCheck(this,t),this.platform=n,this.router=e,this.geolocation=o,this.locationAccuracy=i,this.androidPerm=a,this.currentMapTrack=null,this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.platform.ready().then((function(){t.loadHistoricRoutes();var n={zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1};t.map=new google.maps.Map(t.mapElement.nativeElement,n),t.geolocation.getCurrentPosition().then((function(n){var e=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);t.map.setCenter(e),t.map.setZoom(16)})).catch((function(t){console.log("Error getting location",t)}))}));var n=new google.maps.DistanceMatrixService,e={origins:[{lat:12.991992,lng:76.104787}],destinations:[{lat:13.056618,lng:76.264898}],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.IMPERIAL};n.getDistanceMatrix(e,(function(t,n){if(console.log(t),"OK"===n){this.distanceStr=t.rows[0].elements[0].distance.text;var e=this.distanceStr.replace("mi",""),o=Number(e);this.matrixDistance=(1.6093*o).toFixed(2),this.matrixTime=t.rows[0].elements[0].duration.text,console.log(e)}else alert("Error with distance matrix")}))}},{key:"ionViewDidEnter",value:function(){var t=this;this.platform.backButton.subscribeWithPriority(10,(function(n){console.log("Back press handler!"),t.router.navigate(["/tabs"])}))}},{key:"loadHistoricRoutes",value:function(){var t=JSON.parse(localStorage.getItem("routes"));t&&(this.previousTracks=t)}},{key:"startTracking",value:function(){var t=this;this.isTracking=!0,this.trackedRoute=[],this.positionSubscription=this.geolocation.watchPosition().pipe(Object(c.a)((function(t){return void 0!==t.coords}))).subscribe((function(n){setTimeout((function(){t.trackedRoute.push({lat:n.coords.latitude,lng:n.coords.longitude}),t.redrawPath(t.trackedRoute)}),0)}))}},{key:"redrawPath",value:function(t){this.currentMapTrack&&this.currentMapTrack.setMap(null),t.length>1&&(console.log("origin",t[0].lat,t[0].lng),console.log("destination",t[t.length-1].lat,t[t.length-1].lng),this.distance=this.getDistanceFromLatLonInKm(t[0].lat,t[0].lng,t[t.length-1].lat,t[t.length-1].lng)+"km",this.currentMapTrack=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map))}},{key:"stopTracking",value:function(){var t={finished:(new Date).getTime(),path:this.trackedRoute};this.previousTracks.push(t),localStorage.setItem("routes",JSON.stringify(this.previousTracks)),this.isTracking=!1,this.positionSubscription.unsubscribe(),this.currentMapTrack.setMap(null)}},{key:"showHistoryRoute",value:function(t){this.redrawPath(t)}},{key:"getDistanceFromLatLonInKm",value:function(t,n,e,o){var i=this.deg2rad(e-t),a=this.deg2rad(o-n),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(e))*Math.sin(a/2)*Math.sin(a/2);return(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371).toFixed(0)}},{key:"deg2rad",value:function(t){return t*(Math.PI/180)}}]),t}(),d.\u0275fac=function(t){return new(t||d)(s.Jb(a.K),s.Jb(r.g),s.Jb(l.a),s.Jb(u.a),s.Jb(p.a))},d.\u0275cmp=s.Db({type:d,selectors:[["app-tracking"]],viewQuery:function(t,n){var e;1&t&&s.nc(g,!0),2&t&&s.ec(e=s.Vb())&&(n.mapElement=e.first)},decls:20,vars:3,consts:[["slot","start"],[1,"notifications-btn"],["name","notifications-outline"],[2,"text-align","center"],["full","","icon-left","","class","trackBtn",3,"click",4,"ngIf"],["full","","color","danger","icon-left","","class","trackBtn",3,"click",4,"ngIf"],[1,"map-wrapper"],["id","map"],["map",""],["slot","start",1,"viewRoute",2,"margin-left","20px"],[4,"ngFor","ngForOf"],["full","","icon-left","",1,"trackBtn",3,"click"],["name","locate"],["full","","color","danger","icon-left","",1,"trackBtn",3,"click"],["name","hand"],[2,"font-size","12px"],["slot","end",1,"viewRoute",3,"click"]],template:function(t,n){1&t&&(s.Mb(0,"ion-content"),s.Mb(1,"ion-header"),s.Mb(2,"ion-toolbar"),s.Mb(3,"ion-buttons",0),s.Kb(4,"ion-menu-button"),s.Lb(),s.Mb(5,"ion-title"),s.jc(6," Tracking "),s.Lb(),s.Mb(7,"ion-button",1),s.Kb(8,"ion-icon",2),s.Lb(),s.Lb(),s.Lb(),s.Mb(9,"ion-content"),s.Mb(10,"div",3),s.ic(11,b,3,0,"ion-button",4),s.ic(12,f,3,0,"ion-button",5),s.Lb(),s.Mb(13,"div",6),s.Kb(14,"div",7,8),s.Lb(),s.Mb(16,"ion-list"),s.Mb(17,"ion-button",9),s.jc(18,"Previous Tracks"),s.Lb(),s.ic(19,h,6,4,"ion-item",10),s.Lb(),s.Lb(),s.Lb()),2&t&&(s.zb(11),s.bc("ngIf",!n.isTracking),s.zb(1),s.bc("ngIf",n.isTracking),s.zb(7),s.bc("ngForOf",n.previousTracks))},directives:[a.j,a.m,a.G,a.g,a.t,a.F,a.f,a.n,o.j,a.r,o.i,a.p],pipes:[o.d],styles:["ion-title[_ngcontent-%COMP%]{float:left;top:11px;position:relative;font-weight:400;padding-left:0}.menu-btn[_ngcontent-%COMP%]{float:left}.menu-btn[_ngcontent-%COMP%], .notifications-btn[_ngcontent-%COMP%]{--background:transparent;--box-shadow:none;color:#fff}.notifications-btn[_ngcontent-%COMP%]{float:right}ion-content[_ngcontent-%COMP%]{--background:none;background-image:url(/assets/body-bg.png);background-position:top;background-repeat:no-repeat;background-size:cover}.header-md[_ngcontent-%COMP%]:after{display:none}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--ion-color-base:transparent!important;--box-shadow:none;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:50vh}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   #map_center[_ngcontent-%COMP%]{position:absolute;z-index:99;height:40px;width:40px;top:50%;left:50%;margin-left:-21px;margin-top:-41px}ion-item[_ngcontent-%COMP%]{--background:transparent;color:#fff;width:80%;height:44px;margin:20px auto 0;border-bottom:1px solid #fff}ion-list[_ngcontent-%COMP%]{background:transparent}.trackBtn[_ngcontent-%COMP%]{margin-top:20px;width:80%;height:55px}.trackBtn[_ngcontent-%COMP%], .viewRoute[_ngcontent-%COMP%]{--background:#1d97db;--box-shadow:none;--border-radius:14px;text-transform:none}"]}),d)}],v=((k=function t(){_classCallCheck(this,t)}).\u0275mod=s.Hb({type:k}),k.\u0275inj=s.Gb({factory:function(t){return new(t||k)},imports:[[r.i.forChild(M)],r.i]}),k),w=((m=function t(){_classCallCheck(this,t)}).\u0275mod=s.Hb({type:m}),m.\u0275inj=s.Gb({factory:function(t){return new(t||m)},imports:[[o.b,i.d,a.H,v]]}),m)}}]);