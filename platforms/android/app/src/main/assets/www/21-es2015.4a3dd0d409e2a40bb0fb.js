(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{RhO1:function(t,n,o){"use strict";o.r(n),o.d(n,"TrackingPageModule",(function(){return k}));var i=o("ofXK"),e=o("3Pt+"),a=o("TEn/"),r=o("tyNb"),s=o("pLZG"),c=o("fXoL"),l=o("Bfh1"),g=o("92l+"),p=o("WOgW");const b=["map"];function u(t,n){if(1&t){const t=c.Nb();c.Mb(0,"ion-button",11),c.Ub("click",(function(){return c.fc(t),c.Wb().startTracking()})),c.Kb(1,"ion-icon",12),c.jc(2," Start Tracking "),c.Lb()}}function h(t,n){if(1&t){const t=c.Nb();c.Mb(0,"ion-button",13),c.Ub("click",(function(){return c.fc(t),c.Wb().stopTracking()})),c.Kb(1,"ion-icon",14),c.jc(2," Stop Tracking "),c.Lb()}}function d(t,n){if(1&t){const t=c.Nb();c.Mb(0,"ion-item"),c.Mb(1,"p",15),c.jc(2),c.Xb(3,"date"),c.Lb(),c.Mb(4,"ion-button",16),c.Ub("click",(function(){c.fc(t);const o=n.$implicit;return c.Wb().showHistoryRoute(o.path)})),c.jc(5,"View Route"),c.Lb(),c.Lb()}if(2&t){const t=n.$implicit;c.zb(2),c.mc("",c.Yb(3,2,t.finished),", ",t.path.length," Waypoints ")}}const f=[{path:"",component:(()=>{class t{constructor(t,n,o,i,e){this.platform=t,this.router=n,this.geolocation=o,this.locationAccuracy=i,this.androidPerm=e,this.currentMapTrack=null,this.isTracking=!1,this.trackedRoute=[],this.previousTracks=[]}ngOnInit(){this.platform.ready().then(()=>{this.loadHistoricRoutes();let t={zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1};this.map=new google.maps.Map(this.mapElement.nativeElement,t),this.geolocation.getCurrentPosition().then(t=>{let n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);this.map.setCenter(n),this.map.setZoom(16)}).catch(t=>{console.log("Error getting location",t)})});const t=new google.maps.DistanceMatrixService,n={origins:[{lat:12.991992,lng:76.104787}],destinations:[{lat:13.056618,lng:76.264898}],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.IMPERIAL};t.getDistanceMatrix(n,(function(t,n){if(console.log(t),"OK"===n){this.distanceStr=t.rows[0].elements[0].distance.text;let n=this.distanceStr.replace("mi",""),o=Number(n);this.matrixDistance=(1.6093*o).toFixed(2),this.matrixTime=t.rows[0].elements[0].duration.text,console.log(n)}else alert("Error with distance matrix")}))}ionViewDidEnter(){this.platform.backButton.subscribeWithPriority(10,t=>{console.log("Back press handler!"),this.router.navigate(["/tabs"])})}loadHistoricRoutes(){let t=JSON.parse(localStorage.getItem("routes"));t&&(this.previousTracks=t)}startTracking(){this.isTracking=!0,this.trackedRoute=[],this.positionSubscription=this.geolocation.watchPosition().pipe(Object(s.a)(t=>void 0!==t.coords)).subscribe(t=>{setTimeout(()=>{this.trackedRoute.push({lat:t.coords.latitude,lng:t.coords.longitude}),this.redrawPath(this.trackedRoute)},0)})}redrawPath(t){this.currentMapTrack&&this.currentMapTrack.setMap(null),t.length>1&&(console.log("origin",t[0].lat,t[0].lng),console.log("destination",t[t.length-1].lat,t[t.length-1].lng),this.distance=this.getDistanceFromLatLonInKm(t[0].lat,t[0].lng,t[t.length-1].lat,t[t.length-1].lng)+"km",this.currentMapTrack=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3}),this.currentMapTrack.setMap(this.map))}stopTracking(){let t={finished:(new Date).getTime(),path:this.trackedRoute};this.previousTracks.push(t),localStorage.setItem("routes",JSON.stringify(this.previousTracks)),this.isTracking=!1,this.positionSubscription.unsubscribe(),this.currentMapTrack.setMap(null)}showHistoryRoute(t){this.redrawPath(t)}getDistanceFromLatLonInKm(t,n,o,i){var e=this.deg2rad(o-t),a=this.deg2rad(i-n),r=Math.sin(e/2)*Math.sin(e/2)+Math.cos(this.deg2rad(t))*Math.cos(this.deg2rad(o))*Math.sin(a/2)*Math.sin(a/2);return(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371).toFixed(0)}deg2rad(t){return t*(Math.PI/180)}}return t.\u0275fac=function(n){return new(n||t)(c.Jb(a.M),c.Jb(r.g),c.Jb(l.a),c.Jb(g.a),c.Jb(p.a))},t.\u0275cmp=c.Db({type:t,selectors:[["app-tracking"]],viewQuery:function(t,n){var o;1&t&&c.nc(b,!0),2&t&&c.ec(o=c.Vb())&&(n.mapElement=o.first)},decls:20,vars:3,consts:[["slot","start"],[1,"notifications-btn"],["name","notifications-outline"],[2,"text-align","center"],["full","","icon-left","","class","trackBtn",3,"click",4,"ngIf"],["full","","color","danger","icon-left","","class","trackBtn",3,"click",4,"ngIf"],[1,"map-wrapper"],["id","map"],["map",""],["slot","start",1,"viewRoute",2,"margin-left","20px"],[4,"ngFor","ngForOf"],["full","","icon-left","",1,"trackBtn",3,"click"],["name","locate"],["full","","color","danger","icon-left","",1,"trackBtn",3,"click"],["name","hand"],[2,"font-size","12px"],["slot","end",1,"viewRoute",3,"click"]],template:function(t,n){1&t&&(c.Mb(0,"ion-content"),c.Mb(1,"ion-header"),c.Mb(2,"ion-toolbar"),c.Mb(3,"ion-buttons",0),c.Kb(4,"ion-menu-button"),c.Lb(),c.Mb(5,"ion-title"),c.jc(6," Tracking "),c.Lb(),c.Mb(7,"ion-button",1),c.Kb(8,"ion-icon",2),c.Lb(),c.Lb(),c.Lb(),c.Mb(9,"ion-content"),c.Mb(10,"div",3),c.ic(11,u,3,0,"ion-button",4),c.ic(12,h,3,0,"ion-button",5),c.Lb(),c.Mb(13,"div",6),c.Kb(14,"div",7,8),c.Lb(),c.Mb(16,"ion-list"),c.Mb(17,"ion-button",9),c.jc(18,"Previous Tracks"),c.Lb(),c.ic(19,d,6,4,"ion-item",10),c.Lb(),c.Lb(),c.Lb()),2&t&&(c.zb(11),c.bc("ngIf",!n.isTracking),c.zb(1),c.bc("ngIf",n.isTracking),c.zb(7),c.bc("ngForOf",n.previousTracks))},directives:[a.j,a.m,a.G,a.g,a.t,a.F,a.f,a.n,i.j,a.r,i.i,a.p],pipes:[i.d],styles:["ion-title[_ngcontent-%COMP%]{float:left;top:11px;position:relative;font-weight:400;padding-left:0}.menu-btn[_ngcontent-%COMP%]{float:left}.menu-btn[_ngcontent-%COMP%], .notifications-btn[_ngcontent-%COMP%]{--background:transparent;--box-shadow:none;color:#fff}.notifications-btn[_ngcontent-%COMP%]{float:right}ion-content[_ngcontent-%COMP%]{--background:none;background-image:url(/assets/body-bg.png);background-position:top;background-repeat:no-repeat;background-size:cover}.header-md[_ngcontent-%COMP%]:after{display:none}ion-toolbar[_ngcontent-%COMP%]{--background:transparent;--ion-color-base:transparent!important;--box-shadow:none;color:#fff}#map[_ngcontent-%COMP%]{width:100%;height:50vh}.map-wrapper[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]   #map_center[_ngcontent-%COMP%]{position:absolute;z-index:99;height:40px;width:40px;top:50%;left:50%;margin-left:-21px;margin-top:-41px}ion-item[_ngcontent-%COMP%]{--background:transparent;color:#fff;width:80%;height:44px;margin:20px auto 0;border-bottom:1px solid #fff}ion-list[_ngcontent-%COMP%]{background:transparent}.trackBtn[_ngcontent-%COMP%]{margin-top:20px;width:80%;height:55px}.trackBtn[_ngcontent-%COMP%], .viewRoute[_ngcontent-%COMP%]{--background:#1d97db;--box-shadow:none;--border-radius:14px;text-transform:none}"]}),t})()}];let m=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(n){return new(n||t)},imports:[[r.i.forChild(f)],r.i]}),t})(),k=(()=>{class t{}return t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({factory:function(n){return new(n||t)},imports:[[i.b,e.d,a.H,m]]}),t})()}}]);